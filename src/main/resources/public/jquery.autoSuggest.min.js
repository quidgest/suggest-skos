/*! jQuery AutoSuggest - v2.0.0 - 2012-07-22
* http://hlsolutions.github.com/jquery-autosuggest
* Copyright (c) 2012 Jan Philipp; Licensed MIT, GPL */
(function(){var a,b,c,d;a=jQuery,d=function(){function b(){}return b.prototype._=void 0,b.escapeQuotes=function(a){if(a)return a.replace(/"/g,'\\"')},b.escapeHtml=function(b){return a("<span/>").text(b).html()},b}(),b=function(){function b(){}return b.prototype._=void 0,b.getExtraParams=function(b){var c,d,e,f,g,h,i;f=b.extraParams,a.isFunction(f)&&(f=f(this));if(a.type(f)==="string"){c={},i=f.split("&");for(g=0,h=i.length;g<h;g++){d=i[g];if(d==="")continue;e=d.split("=",2),e.length&&(c[e[0]]=e[1])}f=c}return f},b}(),c=function(){function b(a,b){this.hiddenField=a,this.items=b!=null?b:[]}return b.prototype._=void 0,b.prototype.hiddenField=null,b.prototype.items=null,b.prototype.syncToHiddenField=function(){var a,b,c,d,e;b="",e=this.items;for(c=0,d=e.length;c<d;c++)a=e[c],b+=","+a;b&&(b+=","),this.hiddenField.val(b||",")},b.prototype.add=function(a){this.exist(a)||this.items.push(a),this.syncToHiddenField()},b.prototype.remove=function(b){this.items=a.grep(this.items,function(a){return a!==b}),this.syncToHiddenField()},b.prototype.isEmpty=function(){return this.items.length===0},b.prototype.exist=function(b){return a.inArray(b,this.items)!==-1},b.prototype.getAll=function(){return this.items.slice(0)},b.prototype.clear=function(){this.items=[],this.syncToHiddenField()},b}(),a.fn.autoSuggest=function(e,f){var g,h,i;h={asHtmlID:!1,usePlaceholder:!1,preFill:null,startText:"Enter Name Here",emptyText:"No Results Found",limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:null,selectionClick:null,selectionAdded:null,selectionRemoved:function(a){return a.remove()},formatList:null,beforeRequest:null,afterRequest:null,onAjaxRequestDone:null,onAjaxRequestFail:null,onAjaxRequestAlways:null,resultClick:null,resultsComplete:null,neverSubmit:!1,preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"},inputAttrs:{autocomplete:"off"}},f=a.extend({},h,f),g=null,i=function(){switch(a.type(e)){case"function":return e;case"string":return function(c,d){var h,i,j,k;k={},k[""+f.queryParam]=encodeURIComponent(decodeURIComponent(c)),f.retrieveLimit&&(k[f.limitParam]=encodeURIComponent(f.retrieveLimit)),i=b.getExtraParams(f),a.type(i)==="object"&&a.extend(k,i),h=a.extend({},f.ajaxOptions,{url:e,data:k}),j=function(b){var e;return e=a.isFunction(f.afterRequest)?f.afterRequest.apply(this,[b]):b,d(e,c)},g=a.ajax(h).done(j),f.onAjaxRequestDone&&g.done(f.onAjaxRequestDone),f.onAjaxRequestFail&&g.fail(f.onAjaxRequestFail),f.onAjaxRequestAlways&&g.always(f.onAjaxRequestAlways)};case"array":case"object":return function(a,b){return b(e,a)}}}();if(!i)return;return this.each(function(b){var e,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;f.inputAttrs=a.extend(f.inputAttrs,{}),p=!1,o=a(this),b=null,l=null,f.asHtmlID?(b=f.asHtmlID,l=b):(b=""+b+Math.floor(Math.random()*100),l="as-input-"+b),f.inputAttrs.id=l,f.usePlaceholder&&(f.inputAttrs.placeholder=f.startText),o.attr(f.inputAttrs),o.addClass("as-input"),f.usePlaceholder||o.val(f.startText),o.wrap('<ul class="as-selections" id="as-selections-'+b+'"></ul>').wrap('<li class="as-original" id="as-original-'+b+'"></li>'),E=a("#as-selections-"+b),h=a("#as-original-"+b),C=a('<div class="as-results" id="as-results-'+b+'"></div>'),D=a('<ul class="as-list"></ul>'),m=a('<input type="hidden" class="as-values" name="as_values_'+b+'" id="as-values-'+b+'" />'),k=new c(m),y="",q=null,F=null,z="",u=!1,t=null,x=0,j=function(c,e){var g,i;return k.add(c[f.selectedValuesProp]),i=a('<li class="as-selection-item" id="as-selection-'+e+'" data-value="'+d.escapeQuotes(d.escapeHtml(c[f.selectedValuesProp]))+'"></li>'),i.click(function(){b=a(this),a.isFunction(f.selectionClick)&&f.selectionClick.call(this,b),E.children().removeClass("selected"),b.addClass("selected")}),i.mousedown(function(){p=!1}),g=a('<a class="as-close">&times;</a>'),g.click(function(){return k.remove(c[f.selectedValuesProp]),a.isFunction(f.selectionRemoved)&&f.selectionRemoved.call(this,i),p=!0,o.focus(),!1}),typeof c[f.selectedItemProp]!="string"?h.before(i.append(c[f.selectedItemProp]).prepend(g)):h.before(i.text(c[f.selectedItemProp]).prepend(g)),a.isFunction(f.selectionAdded)&&f.selectionAdded.call(this,h.prev(),c[f.selectedValuesProp]),h.prev()},a.isFunction(f.start)&&f.start.call(this,{add:function(b){var c,d;return c=a(E).find("li").length,d=j(b,"u"+c),d!=null?d.addClass("blur"):void 0},remove:function(a){return k.remove(a),E.find('li[data-value="'+d.escapeHtml(a)+'"]').remove()}});switch(a.type(f.preFill)){case"string":L=f.preFill.split(",");for(H=0,J=L.length;H<J;H++)G=L[H],r={},r[""+f.selectedValuesProp]=G,G!==""&&j(r,"000"+n);y=f.preFill;break;case"array":y="";if(f.preFill.length){M=f.preFill;for(n=I=0,K=M.length;I<K;n=++I)r=M[n],w=r[f.selectedValuesProp],typeof w=="undefined"&&(w=""),y+=w+",",w!==""&&j(r,"000"+n)}}return y!==""&&(o.val(""),E.find("li.as-selection-item").addClass("blur").removeClass("selected")),o.after(m),E.click(function(){p=!0,o.focus()}),E.mousedown(function(){p=!1}),E.after(C),s=function(){var a;a=o.val().replace(/[\\]+|[\/]+/g,"");if(a===z)return;return z=a,a.length>=f.minChars?(E.addClass("loading"),B(a)):(E.removeClass("loading"),C.hide())},B=function(b){return a.isFunction(f.beforeRequest)&&(b=f.beforeRequest.apply(this,[b,f])),e(),i(b,A)},A=function(c,e){var g,h,i,l,m,n,q,s,t,v,w,y,A;f.matchCase||(e=e.toLowerCase()),e=e.replace("(","(","g").replace(")",")","g"),i=0,C.hide().html(D.html("")),m=0;for(t=0,w=c.length;t<w;t++){r=c[t],x++,h=!1;if(f.searchObjProps==="value")q=r.value;else{q="",A=f.searchObjProps.split(",");for(v=0,y=A.length;v<y;v++)l=A[v],q+=""+r[a.trim(l)]+" "}q&&(f.matchCase||(q=q.toLowerCase()),q.indexOf(e)!==-1&&!k.exist(r[f.selectedValuesProp])&&(h=!0));if(h){g=a('<li class="as-result-item" id="as-result-item-'+m+'"></li>'),g.click(function(){var d,e;b=a(this),e=b.data("data"),d=e.num,E.find("#as-selection-"+d).length<=0&&!u&&(c=e.attributes,o.val("").focus(),z="",j(c,d),a.isFunction(f.resultClick)&&f.resultClick.call(this,e),C.hide()),u=!1}),g.mousedown(function(){p=!1}),g.mouseover(function(){b=a(this),D.find("li").removeClass("active"),b.addClass("active")}),g.data("data",{attributes:c[m],num:x}),s=a.extend({},c[m]),e=e.replace(/"/g,'\\"'),n=f.matchCase?new RegExp("(?![^&;]+;)(?!<[^<>]*)("+d.escapeHtml(e)+")(?![^<>]*>)(?![^&;]+;)","g"):new RegExp("(?![^&;]+;)(?!<[^<>]*)("+d.escapeHtml(e)+")(?![^<>]*>)(?![^&;]+;)","gi"),typeof s[f.selectedItemProp]=="string"?(s[f.selectedItemProp]=d.escapeHtml(s[f.selectedItemProp]),f.resultsHighlight&&e.length>0&&(s[f.selectedItemProp]=s[f.selectedItemProp].replace(n,"<em>$1</em>"))):s[f.selectedItemProp].html(s[f.selectedItemProp].html().replace(n,"<em>$1</em>")),f.formatList?g=f.formatList.call(this,s,g):g=g.html(s[f.selectedItemProp]),D.append(g),s=null,i++;if(f.retrieveLimit&&f.retrieveLimit===i)break}m+=1}E.removeClass("loading"),i<=0&&D.html('<li class="as-message">'+f.emptyText+"</li>"),D.css({width:E.outerWidth()}),(i>0||!f.showResultListWhenNoMatch)&&C.show(),a.isFunction(f.resultsComplete)&&f.resultsComplete.call(this)},v=function(a){var b,c,d;if(C.find(":visible").length){c=C.find("li");switch(a){case"down":d=c.eq(0);break;default:d=c.filter(":last")}b=C.find("li.active:first");if(b.length)switch(a){case"down":d=b.next();break;default:d=b.prev()}c.removeClass("active"),d.addClass("active")}},e=function(){if(!g)return;g.abort(),g=null},o.focus(function(){return b=a(this),!f.usePlaceholder&&b.val()===f.startText&&k.isEmpty()?b.val(""):p&&(E.find("li.as-selections-item").removeClass("blur"),b.val()!==""&&(D.css({width:E.outerWidth()}),C.show())),q&&clearInterval(q),q=setInterval(function(){f.showResultList&&(f.selectionLimit&&E.find("li.as-selection-item").length>=f.selectionLimit?(D.html('<li class="as-message">'+f.limitText+"</li>"),C.show()):s())},f.keyDelay),p=!0,f.minChars===0&&B(b.val()),!0}),o.blur(function(){b=a(this),!f.usePlaceholder&&b.val()===""&&k.isEmpty()&&y===""&&f.minChars>0?b.val(f.startText):p&&(E.find("li.as-selection-item").addClass("blur").removeClass("selected"),C.hide()),q&&clearInterval(q)}),o.keydown(function(b){var c,d,g,i,l,m;t=b.keyCode,d=!1;switch(b.keyCode){case 38:b.preventDefault(),v("up");break;case 40:b.preventDefault(),v("down");break;case 8:o.val()===""&&(m=k.getAll(),l=null,m.length?l=m[m.length-1]:l=null,E.children().not(h.prev()).removeClass("selected"),h.prev().hasClass("selected")?(k.remove(l),a.isFunction(f.selectionRemoved)&&f.selectionRemoved.call(this,h.prev())):(a.isFunction(f.selectionClick)&&f.selectionClick.call(this,h.prev()),h.prev().addClass("selected"))),o.val().length===1&&(C.hide(),z="",e()),C.find(":visible").length&&(F&&clearTimeout(F),F=setTimeout(function(){s()},f.keyDelay));break;case 9:case 188:f.canGenerateNewSelections&&(u=!0,g=o.val().replace(/(,)/g,""),c=C.find("li.active:first"),g!==""&&!k.exist(g)&&g.length>=f.minChars&&c.length===0&&(b.preventDefault(),i={},i[""+f.selectedItemProp]=g,i[""+f.selectedValuesProp]=g,j(i,"00"+(E.find("li").length+1)),o.val(""),e()));break;case 13:u=!1,c=C.find("li.active:first"),c.length&&(c.click(),C.hide()),(f.neverSubmit||c.length)&&b.preventDefault();break;case 27:f.preventPropagationOnEscape&&C.find(":visible").length&&b.stopPropagation();break;case 16:case 20:e(),C.hide()}})})}}).call(this);